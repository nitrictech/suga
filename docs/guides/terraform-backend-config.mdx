---
title: 'Terraform Backend Configuration'
description: 'Configure remote state management for Terraform stacks generated with Suga'
---

## Overview

Suga uses [CDKTF](https://developer.hashicorp.com/terraform/cdktf) (Cloud Development Kit for Terraform) to generate Terraform configurations. By default, the generated stacks use local [state](https://developer.hashicorp.com/terraform/language/state) files. For production environments and team collaboration, you'll want to configure a remote backend to store your Terraform state securely and enable state locking.

This guide covers how to add backend configuration to your Suga-generated Terraform stacks for common backend providers.

## Prerequisites

<Info>
  Ensure you have completed these steps before configuring a backend.
</Info>

1. **Generate your Terraform stack** using `suga build` (this runs CDKTF synthesis)
2. **Choose a backend provider** (AWS S3, Google Cloud Storage, Azure Storage, Terraform Cloud, etc.)
3. **Create the backend storage resources** (bucket, storage account, workspace, etc.)
4. **Ensure proper permissions** are configured for accessing the backend

## Understanding Suga's CDKTF Output

When you run `suga build`, CDKTF synthesizes your infrastructure into standard Terraform JSON configuration files:

```bash title="Generated Directory Structure" icon="folder-tree"
terraform/
└── stacks/
    └── <stack_name>/
        ├── cdk.tf.json      # Main configuration
        └── ...
```

The synthesized output can be found in the `terraform` directory.

## Adding Backend Configuration

After running `suga build`, add a backend configuration file to the synthesized output:

### Generate the Stack

```bash title="Generate Terraform Stack" icon="hammer"
suga build
```

### Create Backend Configuration

Create `backend.tf` in the synthesized stack directory:

```bash title="Create Backend File" icon="file-plus"
touch terraform/stacks/<stack_name>/backend.tf
```

### Add Backend Configuration

Choose your backend provider and add the appropriate configuration:

<Tabs>
<Tab title="AWS S3">
  ```hcl title="backend.tf - AWS S3" icon="aws"
  terraform {
    backend "s3" {
      bucket         = "my-terraform-state-bucket"
      key            = "suga/terraform.tfstate"
      region         = "us-east-1"
      encrypt        = true
      dynamodb_table = "terraform-locks"
    }
  }
  ```

  <Warning>
    Ensure your S3 bucket has versioning enabled and consider enabling MFA delete for production environments.
  </Warning>
</Tab>

<Tab title="Google Cloud Storage">
  ```hcl title="backend.tf - Google Cloud" icon="cloud"
  terraform {
    backend "gcs" {
      bucket = "my-terraform-state-bucket"
      prefix = "suga/terraform/state"
    }
  }
  ```

  <Tip>
    Enable object versioning on your GCS bucket to maintain state history.
  </Tip>
</Tab>

<Tab title="Azure Storage">
  ```hcl title="backend.tf - Azure Storage" icon="cloud"
  terraform {
    backend "azurerm" {
      resource_group_name  = "terraform-state-rg"
      storage_account_name = "tfstatestorage"
      container_name       = "terraform-state"
      key                  = "suga.terraform.tfstate"
    }
  }
  ```
</Tab>

<Tab title="Terraform Cloud">
  ```hcl title="backend.tf - Terraform Cloud" icon="cloud"
  terraform {
    backend "remote" {
      organization = "my-org"
      workspaces {
        name = "suga-production"
      }
    }
  }
  ```
</Tab>
</Tabs>

### Initialize and Deploy

```bash title="Initialize Terraform" icon="terminal"
cd terraform/stacks/<stack_name>
terraform init
```

```bash title="Deploy Infrastructure" icon="rocket"
terraform apply
```

<Info>
  Only the cdktf files are managed by Suga. You can safely add custom `.tf` files to the stack directory to extend the configuration.
</Info>

## Managing Multiple Environments

For managing multiple environments, we recommend using Terraform workspaces:

```bash title="Create and Switch Workspaces" icon="git-branch"
# Create and switch to staging environment
terraform workspace new staging

# Switch to production environment
terraform workspace new production
terraform workspace select production
```

<Tip>
  Each workspace maintains its own state file, allowing you to manage different environments with the same configuration.
</Tip>

For comprehensive documentation on best practices, see the [official Terraform workspace docs](https://developer.hashicorp.com/terraform/language/state/workspaces).